<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Business Listings|Bookmarks|LocalLink</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <nav>
            <nav>
            <div class="HeaderTabs">
              <div class="logo-container">
              <img src="favicon.ico" alt="LocalLink Logo" class="logo-img">
            </div>

                <p><a href="index.html" id="home-tab-btn">Home</a></p>
                <p><a href="BusinessListing.html" id="business-listings-button">Business Listing|Bookmarks</a></p>
                <p><a href="deals.html" id="deals-tab-btn">Deals</a></p>
                <div class="theme-toggle">
                  <input type="checkbox" id="theme-switch" aria-label="Toggle dark mode">
                  <label for="theme-switch" class="toggle-label"><span class="toggle-ball"><span class="icon-sun">‚òÄÔ∏è</span><span class="icon-moon">üåô</span></span></label>
                </div>
            </div>


        </nav>

    </nav>
  </header>


  <main>
    <h1 style="text-align:center; margin-top:18px;">Business Listings</h1>
    <p>This will be the business listings page with different businesses near you! Click on the checkbox to save and bookmark a business card!</p>
    <div class="deals-bar">
        		<input type="text" placeholder="Search Business Listings..." id="search-bar">
		    </div>
    <br>
    <br>
    <button class="bookmark-button" onclick="scrollToBottom()">Go to Bookmarks</button>
  <script>
    function scrollToBottom() {
      window.scrollTo({
        top: document.body.scrollHeight,
        behavior: "smooth"
      });
    }
  </script>
    <br>


    <!-- where listing cards will be added -->
    <div id="listings"></div>


    <!-- Bookmarks area (on this page only ‚Äî no persistence yet) -->
    <section style="margin-top:30px;">
      <h2>------------------------------------------------------------Bookmarked Businesses------------------------------------------------------------</h2>
      <div id="bookmarked-businesses"></div>
    </section>


    <!-- Load your data file BEFORE the inline script below -->
    <!-- If your file is named SampleData.js, change the src accordingly. -->
    <script src="SampleData.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById("listings");
        const bookmarksContainer = document.getElementById("bookmarked-businesses");

        function renderBookmarks() {
          if (!bookmarksContainer) return;
          bookmarksContainer.innerHTML = '';
          LISTINGS.filter(b => b.bookmarked).forEach(business => {
            const div = document.createElement('div');
            div.className = 'business-card small';
            div.innerHTML = `<h3>${business.name}</h3><p>${business.shortDescription || business.category || ''}</p>`;
            bookmarksContainer.appendChild(div);
          });
          if (bookmarksContainer.children.length === 0) {
            bookmarksContainer.innerHTML = '<p>No bookmarks yet. Click "Save" on a listing to add it.</p>';
          }
        }

        container.innerHTML = '';

        LISTINGS.forEach(business => {
          const card = document.createElement("div");
          card.classList.add("business-card");


          card.innerHTML = `
            <h2>${business.name}</h2>
            <p>${business.category}</p>
            <p>${business.address || ''}</p>
            <p>Rating: ${business.rating} (${business.reviewCount || 0} reviews)</p>
            <p>Price Range: ${"$".repeat(business.priceRange || 0)}</p>
            <button 
            class="review-btn" 
            onclick="window.open('${business.website}', '_blank', 'noopener')"
            >
            Visit Website
            </button>
            <button class="review-btn">Leave a Review</button>
            <button class="analyze-btn">ü§ñ Analyze Reviews</button>
            <label class="bookmark-toggle">
              <input type="checkbox" class="bookmark-checkbox" data-id="${business.id}">
              <span class="checkmark"></span>
            </label>
            
            <div class="analysis-box">
              <div class="analysis-summary"></div>
              <div class="analysis-sentiment"></div>
              <div class="analysis-keywords"></div>
            </div>
            <hr>
          `;

          container.appendChild(card);

          const checkbox = card.querySelector('.bookmark-checkbox');
          checkbox.addEventListener('change', () => {
            business.bookmarked = checkbox.checked;
            if (checkbox.checked) {
              console.log(`Bookmarked: ${business.name}`);
            } else {
              console.log(`Removed bookmark: ${business.name}`);
            }
            renderBookmarks();
          });

          const analyzeBtn = card.querySelector(".analyze-btn");
          const analysisBox = card.querySelector(".analysis-box");
          const summaryEl = card.querySelector(".analysis-summary");
          const sentimentEl = card.querySelector(".analysis-sentiment");
          const keywordsEl = card.querySelector(".analysis-keywords");

          const POS_WORDS = ["good","great","excellent","friendly","delicious","clean","fast","love","amazing","nice","best","helpful","comfortable","tasty","recommend","perfect","wonderful","awesome","fantastic","outstanding","pleasant","cozy","fresh","quality","enjoyed"];
          const NEG_WORDS = ["bad","poor","slow","dirty","hate","terrible","expensive","rude","worst","noisy","disappointing","broken","late","smelly","awful","horrible","nasty","unpleasant","mediocre","overpriced","crowded","cold"];

          const STOPWORDS = ["the","and","a","an","to","is","it","in","of","for","with","on","at","by","this","that","was","are","be","as","or","from","have","has","had","but","not","they","their","there","these","those"];

          function splitSentences(text){
            return text.split(/(?<=[.!?])\s+/).map(s => s.trim()).filter(Boolean);
          }

          function sentimentScore(text){
            const words = text.toLowerCase().replace(/[^\w\s]/g, "").split(/\s+/).filter(Boolean);
            let score = 0;
            for(const w of words){
              if(POS_WORDS.includes(w)) score += 1;
              if(NEG_WORDS.includes(w)) score -= 1;
            }
            return score;
          }

          function topKeywords(allText, limit=5){
            const words = allText.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(w => w && !STOPWORDS.includes(w));
            const freq = {};
            for(const w of words){
              freq[w] = (freq[w]||0) + 1;
            }
            return Object.entries(freq)
              .sort((a,b) => b[1]-a[1])
              .slice(0, limit)
              .map(x => x[0]);
          }

          function summarizeReviews(reviews, lines=2){
            const allText = reviews.map(r => r.text || r).join(" ");
            if(!allText.trim()) return "No reviews to summarize.";
            const sentences = splitSentences(allText);
            const keywords = topKeywords(allText, 20);
            const scores = sentences.map(s => {
              let sScore = sentimentScore(s);
              const sWords = s.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/);
              for(const k of keywords.slice(0,10)) if(sWords.includes(k)) sScore += 0.5;
              return { s, score: sScore };
            });
            scores.sort((a,b) => b.score - a.score);
            const chosen = scores.slice(0, lines).map(x => x.s);
            return chosen.join(" ");
          }

          function analyzeBusiness(b){
            const reviews = (b.reviews || []).map(r => r.text || "");
            const allText = reviews.join(" ");
            if(!allText.trim()){
              return {
                summary: "No reviews available.",
                sentiment: "No data",
                sentimentClass: "sentiment-neutral",
                keywords: []
              };
            }
            let total = 0;
            for(const r of reviews) total += sentimentScore(r);
            const avg = total / Math.max(1, reviews.length);

            let sentimentLabel = "Neutral";
            let sentimentClass = "sentiment-neutral";
            if(avg > 0.5) {
              sentimentLabel = "Positive";
              sentimentClass = "sentiment-positive";
            } else if(avg < -0.5) {
              sentimentLabel = "Negative";
              sentimentClass = "sentiment-negative";
            }

            return {
              summary: summarizeReviews(reviews, 2),
              sentiment: `${sentimentLabel} (score ${avg.toFixed(2)})`,
              sentimentClass: sentimentClass,
              keywords: topKeywords(allText, 6)
            };
          }

          analyzeBtn.addEventListener("click", () => {
            if(analysisBox.classList.contains('active')){
              analysisBox.classList.remove('active');
              analyzeBtn.textContent = "ü§ñ Analyze Reviews";
              return;
            }
            const res = analyzeBusiness(business);
            summaryEl.innerHTML = `<strong>Summary:</strong> ${res.summary}`;
            sentimentEl.innerHTML = `<strong>Overall Sentiment:</strong> <span class="${res.sentimentClass}">${res.sentiment}</span>`;
            keywordsEl.innerHTML = `<strong>Top Keywords:</strong> ${res.keywords.map(k => `<span class="keyword-chip">${k}</span>`).join("")}`;
            analysisBox.classList.add('active');
            analyzeBtn.textContent = "ü§ñ Hide Analysis";
          });
        });

        renderBookmarks();
      });
    </script>
  </main>

  <br>
  <br>

  <center>
    <a href="BusinessListing.html">Go back to top</a>
  </center>


  <footer>
    <p>&copy; 2025 LocalLink</p>
  </footer>




  <script src="app.js"></script>
</body>
</html>
